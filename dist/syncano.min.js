/*! syncano 02-04-2014 */
!function(a,b){"use strict";function c(a){var b={},c="Boolean Number String Function Array Date RegExp Object".split(" ");for(var d in c)b["[object "+c[d]+"]"]=c[d].toLowerCase();return null===a?String(a):b[Object.prototype.toString.call(a)]||"object"}function d(a){return"function"===c(a)}function e(a){return null!==a&&a==a.window}function f(a){var d=Object.prototype.hasOwnProperty;if(!a||"object"!==c(a)||a.nodeType||e(a))return!1;try{if(a.constructor&&!d.call(a,"constructor")&&!d.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(f){return!1}var g;for(g in a);return g===b||d.call(a,g)}function g(a){return"array"===c(a)}function h(){var a,c,e,i,j,k,l=arguments[0]||{},m=1,n=arguments.length,o=!1;for("boolean"==typeof l&&(o=l,l=arguments[1]||{},m=2),"object"==typeof l||d(l)||(l={});n>m;m++)if(null!==(a=arguments[m]))for(c in a)e=l[c],i=a[c],l!==i&&(o&&i&&(f(i)||(j=g(i)))?(j?(j=!1,k=e&&g(e)?e:[]):k=e&&f(e)?e:{},l[c]=h(o,k,i)):i!==b&&(l[c]=i));return l}function i(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];a.charCodeAt(c)>=97?b.push(e):(b.push("_"),b.push(e.toLowerCase()))}return b.join("")}function j(a){return"undefined"!=typeof a&&null!==a}function k(a){return"number"==typeof a||parseInt(a,10)==a?!0:!1}function l(a){var b=new Date(a);return"[object Date]"!==Object.prototype.toString.call(b)?!1:!isNaN(b.getTime())}function m(a,b){return-1!==b.indexOf(a)?!0:!1}function n(a){return"boolean"==typeof a}var o={},p={},q=0;o.on=function(a,b){if("function"!=typeof b)return!1;p.hasOwnProperty(a)||(p[a]={});var c="uid_"+ ++q;return p[a][c]=b,c},o.hasSubscribers=function(a){return"string"!=typeof a?!1:p.hasOwnProperty(a)&&Object.keys(p[a]).length?!0:!1},o.off=function(a,b){if(!this.hasSubscribers(a))return!1;if("undefined"==typeof b)return delete p[a];var c=p[a];for(var d in c)if(c.hasOwnProperty(d)&&b===c[d])return delete p[a][d];return!1},o.trigger=function(a){return o.doTrigger(a,!1,Array.prototype.slice.call(arguments,1))},o.triggerSync=function(a){return o.doTrigger(a,!0,Array.prototype.slice.call(arguments,1))},o.doTrigger=function(a,b){var c,d,e,f=!1,g=Array.prototype.slice.call(arguments,2)[0];if(this.hasSubscribers(a)){c=p[a];for(d in c)c.hasOwnProperty(d)&&(e=c[d],b===!1?setTimeout(e.call(e,g),0):e.call(e,g),f=!0)}var h="all";if(this.hasSubscribers(h)){c=p[h];for(d in c)c.hasOwnProperty(d)&&(e=c[d],b===!1?setTimeout(e.call(e,a,g),0):e.call(e,a,g),f=!0)}return f};var r={};r.new=function(a,b,c){var d="project.new",e={name:a,description:b};this.__super__.__sendWithCallback(d,e,"project",c)},r.get=function(a){var b="project.get";this.__super__.__sendWithCallback(b,{},"project",a)},r.getOne=function(a,b){this.__super__.__checkProjectId(a);var c="project.get_one";this.__super__.__sendWithCallback(c,{id:a},"project",b)},r.update=function(a,b,c,d){if(this.__super__.__checkProjectId(a),!("undefined"!=typeof b&&null!==b||"undefined"!=typeof c&&null!==b))return!1;var e="project.update",f={};b&&(f.name=b),"undefined"!=typeof c&&null!==c&&(f.description=c),this.__super__.__sendWithCallback(e,f,"project",d)},r.delete=function(a,b){this.__super__.__checkProjectId(a);var c="project.delete";this.__super__.__sendWithCallback(c,{project_id:a},null,b)};var s={};s.new=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="collection.new",g={name:b,project_id:a};"undefined"!=typeof d&&null!==d&&(g.description=d),"undefined"!=typeof c&&null!==c&&(g.key=c),this.__super__.__sendWithCallback(f,g,"collection",e)},s.get=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.get",f={project_id:a};("undefined"==typeof b||null===b)&&(f.status="all"),"undefined"!=typeof c&&null!==c&&(f.with_tags=c),this.__super__.__sendWithCallback(e,f,"collection",d)},s.getOne=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.get_one",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,"collection",c)},s.activate=function(a,b,c,d){if(this.__super__.__checkProjectId(a),"number"!=typeof b)throw new Error("Collection.activate - collectionId must be a number");var e="collection.activate",f={project_id:a,collection_id:b};f.force="undefined"==typeof c||null===c?!1:c,this.__super__.__sendWithCallback(e,f,null,d)},s.deactivate=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.deactivate",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)},s.update=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="collection.update",g={project_id:a};g=this.__super__.__addCollectionIdentifier(g,b),"undefined"!=typeof c&&null!==c&&(g.name=c),"undefined"!=typeof d&&null!==d&&(g.name=d),this.__super__.__sendWithCallback(f,g,"collection",e)},s.addTag=function(a,b,c,d,e,f){this.__super__.__checkProjectId(a);var g="collection.add_tag",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,b),"string"!=typeof c&&("object"!=typeof c||"undefined"==typeof c.length))throw new Error("Collection.addTag - tags must be passed");var i;if(i="string"==typeof c?c:c.join(","),!/^[\000-\177]*$/.test(i))throw new Error("Collection.addTag - non ascii characters found in tag name");h.tags=c,h.weight=d||1,h.remove_other=!!e||!1,this.__super__.__sendWithCallback(g,h,null,f)},s.deleteTag=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.delete_tag",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"!=typeof c&&("object"!=typeof c||"undefined"==typeof c.length))throw new Error("Collection.deleteTag - tags must be passed");var g;if(g="string"==typeof c?c:c.join(","),!/^[\000-\177]*$/.test(g))throw new Error("Collection.deleteTag - non ascii characters found in tag name");f.tags=c,this.__super__.__sendWithCallback(e,f,null,d)},s.delete=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.delete",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)};var t={};t.new=function(a,b,c,d){if(this.__super__.__checkProjectId(a),!c)throw new Error("Folder must have a name");var e="folder.new",f={name:c,project_id:a};f=this.__super__.__addCollectionIdentifier(f,b),this.__super__.__sendWithCallback(e,f,"folder",d)},t.get=function(a,b,c){this.__super__.__checkProjectId(a);var d="folder.get",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,"folder",c)},t.getOne=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="folder.get_one",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"!=typeof c)throw new Error("FolderName must be a string");f.folder_name=c,this.__super__.__sendWithCallback(e,f,"folder",d)},t.update=function(a,b,c,d,e,f){if("object"==typeof arguments[3]){var g=Object.create(arguments[3]);f=arguments[4],d=g.newName,e=g.sourceId}this.__super__.__checkProjectId(a);var h="folder.update",i={project_id:a};if(i=this.__super__.__addCollectionIdentifier(i,b),"string"!=typeof c)throw new Error("FolderName must be a string");if(i.name=c,"undefined"==typeof d||null===d)throw new Error("newName must be passed");if("string"!=typeof d)throw new Error("newName must be a string");i.new_name=d,null!==e&&(i.source_id=e+""),this.__super__.__sendWithCallback(h,i,"folder",f)},t.delete=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="folder.delete",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"!=typeof c)throw new Error("FolderName must be a string");f.name=c,this.__super__.__sendWithCallback(e,f,null,d)};var u={};u.new=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.new",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){for(var g=["dataKey","userName","sourceUrl","title","text","link","image","imageUrl","folder","state"],h=0;h<g.length;h++){var l=g[h];if(j(c[l])){if("string"!=typeof c[l])throw new Error(l+" must be a string");f[i(l)]=c[l]}}if(j(c.parentId)){if(k(c.parentId))throw new Error("parentId must be a number");f.parent_id=c.parentId}if(j(f.state)&&-1==["pending","moderated","rejected"].indexOf(f.state.toLowerCase()))throw new Error("incorrect value of state param");if(j(c.additional))for(var m in c.additional)if(c.additional.hasOwnProperty(m)){var n=c.additional[m];if(-1!==g.indexOf(m)||"parent_id"===m)throw new Error("Cannot use additional (custom) param named "+m);f[m]=n}}this.__super__.__sendWithCallback(e,f,"data",d)},u.get=function(a,b,c,d){var e;this.__super__.__checkProjectId(a);var f="data.get",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),j(c)){var h=["dataIds","folders","byUser","parentIds"];for(e=0;e<h.length;e++){var o=h[e];j(c[o])&&(g[i(o)]=c[o])}var p=["maxId","limit","sinceId","depth","childrenLimit"];for(e=0;e<p.length;e++){var q=p[e];if(j(c[q])){if(!k(c[q]))throw new Error(q+" must be a number");g[i(q)]=c[q]}}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");g.state=c.state}if(j(c.sinceTime)){if(!l(c.sinceTime))throw new Error("Param sinceTime must be a proper date string");g.since_time=c.sinceTime}if(j(c.order)){if(-1===["asc","desc"].indexOf(c.order.toLowerCase()))throw new Error('incorrect value of order param - only "asc" and "desc" are allowed');g.order=c.order}if(j(c.orderBy)){if(!m(c.orderBy.toLowerCase(),["created_at","updated_at"]))throw new Error('incorrect value of order_by param - only "created_at" and "updated_at" are allowed');g.order_by=c.orderBy}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');g.filter=c.filter}if(j(c.includeChildren)){if(!n(c.includeChildren))throw new Error("includeChildren param must be boolean");g.include_children=c.includeChildren}}this.__super__.__sendWithCallback(f,g,"data",d)},u.getOne=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.get_one",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"==typeof c)f.data_key=c;else{if("number"!=typeof c)throw new Error("Data key/id must be passed");f.data_id=c}this.__super__.__sendWithCallback(e,f,"data",d)},u.update=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.update",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),"string"==typeof c)g.data_key=c;else{if("number"!=typeof c)throw new Error("Data key/id must be passed");g.data_id=c}if(j(d)){for(var h=["updateMethod","userName","sourceUrl","title","text","link","image","imageUrl"],l=0;l<h.length;l++){var n=h[l];j(d[n])&&(g[i(n)]=d[n])}if(j(d.parentId)){if(k(d.parentId))throw new Error("parentId must be a number");g.parent_id=d.parentId}if(j(d.state)){if(!m(d.state.toLowerCase(),["pending","moderated","rejected"]))throw new Error("incorrect value of state param");g.state=d.state}}this.__super__.__sendWithCallback(f,g,"data",e)},u.move=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.move",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),"string"==typeof c)g.data_key=c;else{if("number"!=typeof c)throw new Error("Data key/id must be passed");g.data_id=c}if(j(d)){for(var h=["dataIds","folders","byUser","newFolder"],l=0;l<h.length;l++){var n=h[l];j(d[n])&&(g[i(n)]=d[n])}if(j(d.filter)){if(!m(d.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');g.filter=d.filter}if(j(d.state)){if(!m(d.state.toLowerCase(),["pending","moderated","rejected"]))throw new Error("incorrect value of state param");g.state=d.state}if(j(d.newState)){if(!m(d.newState.toLowerCase(),["pending","moderated","rejected"]))throw new Error("incorrect value of newState param");g.new_state=d.newState}if(j(d.limit)){if(k(d.limit))throw new Error("limit must be a number");g.limit=d.limit}}this.__super__.__sendWithCallback(f,g,null,e)},u.copy=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.copy",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),k(c))f.data_ids=[c+""];else if("undefined"!=typeof c.length){f.data_ids=[];for(var g=0;g<c.length;g++){if(!k(c[g]))throw new Error("dataId must be integer or array of integers");f.data_ids.push(c[g]+"")}}this.__super__.__sendWithCallback(e,f,"data",d)},u.addParent=function(a,b,c,d,e,f){this.__super__.__checkProjectId(a);var g="data.add_parent",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,b),!j(c)||!k(c))throw new Error("dataId must be passed");if(h.data_id=c,!j(d)||!k(d))throw new Error("parentId must be passed");h.parent_id=d,j(e)&&n(e)&&(h.remove_other=e),this.__super__.__sendWithCallback(g,h,null,f)},u.removeParent=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.remove_parent",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!j(c)||!k(c))throw new Error("dataId must be passed");g.data_id=c,j(d)&&k(d)&&(g.parent_id=d),this.__super__.__sendWithCallback(f,g,null,e)},u.addChild=function(a,b,c,d,e,f){this.__super__.__checkProjectId(a);var g="data.add_child",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,b),!j(c)||!k(c))throw new Error("dataId must be passed");if(h.data_id=c,!j(d)||!k(d))throw new Error("childId must be passed");h.child_id=d,j(e)&&n(e)&&(h.remove_other=e),this.__super__.__sendWithCallback(g,h,null,f)},u.removeChild=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.remove_child",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!j(c)||!k(c))throw new Error("dataId must be passed");g.data_id=c,j(d)&&k(d)&&(g.child_id=d),this.__super__.__sendWithCallback(f,g,null,e)},u.delete=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.delete",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){for(var g=["dataIds","folders","byUser"],h=0;h<g.length;h++){var l=g[h];j(c[l])&&(f[i(l)]=c[l])}if(j(c.limit)){if(!k(c.limit))throw new Error("limit must be a number");f.limit=c.limit}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}}this.__super__.__sendWithCallback(e,f,null,d)},u.count=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.count",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){for(var g=["folders","byUser"],h=0;h<g.length;h++){var k=g[h];j(c[k])&&(f[i(k)]=c[k])}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}}this.__super__.__sendWithCallback(e,f,"count",d)};var v={};v.new=function(a,b,c){var d="user.new",e={};if(!j(a))throw new Error("user must have a name");e.user_name=a,j(b)&&(e.nick=b),this.__super__.__sendWithCallback(d,e,"user",c)},v.getAll=function(a,c,d){var e="user.get_all";"function"==typeof arguments[0]&&(d=arguments[0],a=b,c=b);var f={};if(j(a)){if(!k(a))throw new Error("sinceId must be a number");f.since_id=a}if(j(c)){if(!k(c))throw new Error("limit must be a number");f.limit=c}this.__super__.__sendWithCallback(e,f,"user",d)},v.get=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="user.get",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){if(j(c.folders)&&(f.folders=c.folders),j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}}this.__super__.__sendWithCallback(e,f,"user",d)},v.getOne=function(a,b){var c="user.get_one",d={};"number"==typeof a?d.user_id=a:"string"==typeof a&&(d.user_name=a),this.__super__.__sendWithCallback(c,d,"user",b)},v.update=function(a,b,c){var d="user.update",e={};"number"==typeof a?e.user_id=a:"string"==typeof a&&(e.user_name=a),j(b)&&"string"==typeof b&&(e.nick=b),this.__super__.__sendWithCallback(d,e,"user",c)},v.count=function(a,c){var d="user.count",e={};if(1===arguments.length&&(c=arguments[0],a=b),j(a)){if(j(a.projectId)&&k(a.projectId)&&(e.project_id=a.projectId),j(a.collection))if("string"==typeof a.collection)e.collection_key=a.collection;else{if("number"!=typeof a.collection)throw new Error("collection identifier must be a string (key) or number (id)");e.collection_id=a.collection}if(j(a.folders)&&(e.folders=a.folders),j(a.state)){if(!m(a.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");e.state=a.state}if(j(a.filter)){if(!m(a.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');e.filter=a.filter}}this.__super__.__sendWithCallback(d,e,"count",c)},v.delete=function(a,b){var c="user.delete",d={};"number"==typeof a?d.user_id=a:"string"==typeof a&&(d.user_name=a),this.__super__.__sendWithCallback(c,d,!0,b)};var w={};w.subscribeProject=function(a,b){var c="subscription.subscribe_project";if(!j(a)||!k(a))throw new Error("projectId must be defined");this.__super__.__sendWithCallback(c,{project_id:a},!0,b)},w.unsubscribeProject=function(a,b){var c="subscription.unsubscribe_project";if(!j(a)||!k(a))throw new Error("projectId must be defined");this.__super__.__sendWithCallback(c,{project_id:a},!0,b)},w.subscribeCollection=function(a,b,c){this.__super__.__checkProjectId(a);var d="subscription.subscribe_collection",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)},w.unsubscribeCollection=function(a,b,c){this.__super__.__checkProjectId(a);var d="subscription.unsubscribe_collection",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)},w.get=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="subscription.get",e={};j(a)&&(e.api_client_id=a),this.__super__.__sendWithCallback(d,e,"subscription",c)};var x={};x.get=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="identity.get",e={};if(j(a)){for(var f=["apiClientId","sinceId","limit"],g=0;g<f.length;g++){var h=f[g];if(j(a[h])){if(!k(a[h]))throw new Error(d+": "+h+" must be a number");e[i(h)]=a[h]}}if(j(a.name)){if("string"!=typeof a.name)throw new Error(d+": name must be a string");e.name=a.name}}this.__super__.__sendWithCallback(d,e,"identity",c)},x.update=function(a,c,d){"function"==typeof arguments[1]&&(d=arguments[1],c=b);var e="identity.update",f={};if(!j(a)||"string"!=typeof a)throw new Error(e+": uuid parameter is required");if(f.uuid=a,j(c)){if(j(c.apiClientId)){if(!k(c.apiClientId))throw new Error(e+": apiClientId must be a number");f.api_client_id=c.apiClientId}if(j(c.name)){if("string"!=typeof c.name)throw new Error(e+": name must be a string");f.name=c.name}if(j(c.state)){if("string"!=typeof c.state)throw new Error(e+": state must be a string");f.state=c.state}}this.__super__.__sendWithCallback(e,f,"identity",d)};var y={};y.send=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="notification.send",e={};if(j(a)){if(j(a.apiClientId)){if(!k(a.apiClientId))throw new Error(d+": apiClientId must be a number");e.api_client_id=a.apiClientId}if(j(a.uuid)){if("string"!=typeof a.uuid)throw new Error(d+": uuid must be a string");e.uuid=a.uuid}if(j(a.data))for(var f in a.data)if(a.data.hasOwnProperty(f)){var g=a.data[f];if(m(f,["apiClientId","api_client_id","uuid"]))throw new Error(d+": Cannot send custom param named "+f);e[f]=g}}this.__super__.__sendWithCallback(d,e,!0,c)},y.getHistory=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="notification.get_history",e={};if(j(a)){if(j(a.apiClientId)){if(!k(a.apiClientId))throw new Error(d+": apiClientId must be a number");e.api_client_id=a.apiClientId}for(var f=["limit","sinceId"],g=0;g<f.length;g++){var h=f[g];if(j(a[h])){if(!k(a[h]))throw new Error(d+": "+h+" must be a number");e[i(h)]=a[h]}}if(j(a.sinceTime)){if(!l(a.sinceTime))throw new Error(d+": sinceTime must be a proper date string");e.since_time=a.sinceTime}if(j(a.order)){if(!m(a.order.toLowerCase(),["asc","desc"]))throw new Error(d+': incorrect value of order param - only "asc" and "desc" are allowed');e.order=a.order}}this.__super__.__sendWithCallback(d,e,"history",c)};var z={DISCONNECTED:1,CONNECTED:2,AUTHORIZED:3},A=function(){this.socketURL="https://api.hydraengine.com/ws",this.socket=null,this.status=z.DISCONNECTED,this.requestId=1,this.uuid=null,this.requestsQueue=[],this.waitingForResponse={},this.Project=r,this.Project.__super__=this,this.Collection=s,this.Collection.__super__=this,this.Folder=t,this.Folder.__super__=this,this.Data=u,this.Data.__super__=this,this.User=v,this.User.__super__=this,this.Subscription=w,this.Subscription.__super__=this,this.Identity=x,this.Identity.__super__=this,this.Notification=y,this.Notification.__super__=this};A.prototype=h(A.prototype,o),A.prototype.connect=function(b,c){if("undefined"==typeof b||"undefined"==typeof b.api_key||"undefined"==typeof b.instance)throw new Error("syncano.connect requires instance name and api_key");if("undefined"==typeof a.SockJS)throw new Error("SockJS is required");return this.connectionParams=b,this.status!=z.DISCONNECTED?void(this.reconnectOnSocketClose=!0):("function"==typeof c&&(this.waitingForResponse.auth=["auth",c]),this.socket=new a.SockJS(this.socketURL),this.socket.onopen=this.onSocketOpen.bind(this),this.socket.onclose=this.onSocketClose.bind(this),void(this.socket.onmessage=this.onMessage.bind(this)))},A.prototype.onSocketOpen=function(){this.status=z.CONNECTED,this.socketSend(this.connectionParams)},A.prototype.onSocketClose=function(){this.status=z.DISCONNECTED,this.socket=null,this.reconnectOnSocketClose===!0&&(this.reconnectOnSocketClose=!1,this.connect(this.connectionParams))},A.prototype.onMessage=function(a){var b=JSON.parse(a.data);if("NOK"===b.result)return this.trigger("syncano:error",b.data.error),void("auth"===b.type&&(this.socket.close(),this.trigger("syncano:auth:error")));switch(this.trigger("syncano:received",b),b.type){case"auth":this.parseAuthorizationResponse(b);break;case"callresponse":this.parseCallResponse(b);break;case"message":this.parseMessageNotifier(b);break;case"new":this.parseNewRecordNotifier(b)}},A.prototype.parseAuthorizationResponse=function(a){this.uuid=a.uuid,this.status=z.AUTHORIZED,this.trigger("syncano:authorized",this.uuid),this.parseCallResponse({message_id:"auth",data:a}),this.sendQueue()},A.prototype.parseNewRecordNotifier=function(a){var b=0|a.channel.project_id,c=0|a.channel.collection_id,d=a.data,e=d.folder;e&&this.trigger("syncano:newdata:folder-"+e,d),this.trigger("syncano:newdata:project-"+b,d),this.trigger("syncano:newdata:collection-"+c,d)},A.prototype.parseMessageNotifier=function(a){this.trigger("syncano:message",a)},A.prototype.parseCallResponse=function(a){var b=a.message_id;if("undefined"!=typeof b&&"undefined"!=typeof this.waitingForResponse[b]){var c=this.waitingForResponse[b],d=c[0].replace(".",":"),e=c[1];this.trigger("syncano:"+d,a.data),"function"==typeof e&&e(a.data),delete this.waitingForResponse[b]}else this.trigger("syncano:ignored",a)},A.prototype.sendQueue=function(){for(;this.requestsQueue.length>0;){var a=this.requestsQueue.shift();this.socketSend(a)}},A.prototype.getNextRequestId=function(){return this.requestId++},A.prototype.socketSend=function(a){this.socket.send(JSON.stringify(a)+"\n")},A.prototype.sendRequest=function(a,b,c){"undefined"==typeof b&&(b={});var d={type:"call",method:a,params:b};d.message_id=this.getNextRequestId(),this.waitingForResponse[d.message_id]=[a,c],this.status==z.AUTHORIZED?(this.trigger("syncano:call",d),this.socketSend(d)):(this.trigger("syncano:queued",d),this.requestsQueue.push(d))},A.prototype.__checkProjectId=function(a){if("number"!=typeof a)throw new Error("projectId must be a number")},A.prototype.__addCollectionIdentifier=function(a,b){if("string"==typeof b)a.collection_key=b;else{if("number"!=typeof b)throw new Error("Collection key/id must be passed");a.collection_id=b}return a},A.prototype.__sendWithCallback=function(a,b,c,d){this.sendRequest(a,b,function(a){var b;b=null===c?!0:a[c],"function"==typeof d&&d(b)})};var B=null;a.SyncanoConnector={getInstance:function(){return null===B&&(B=new A),B}}}(this);